(function(t){function i(i){for(var n,r,s=i[0],l=i[1],c=i[2],f=0,u=[];f<s.length;f++)r=s[f],Object.prototype.hasOwnProperty.call(o,r)&&o[r]&&u.push(o[r][0]),o[r]=0;for(n in l)Object.prototype.hasOwnProperty.call(l,n)&&(t[n]=l[n]);d&&d(i);while(u.length)u.shift()();return a.push.apply(a,c||[]),e()}function e(){for(var t,i=0;i<a.length;i++){for(var e=a[i],n=!0,s=1;s<e.length;s++){var l=e[s];0!==o[l]&&(n=!1)}n&&(a.splice(i--,1),t=r(r.s=e[0]))}return t}var n={},o={app:0},a=[];function r(i){if(n[i])return n[i].exports;var e=n[i]={i:i,l:!1,exports:{}};return t[i].call(e.exports,e,e.exports,r),e.l=!0,e.exports}r.m=t,r.c=n,r.d=function(t,i,e){r.o(t,i)||Object.defineProperty(t,i,{enumerable:!0,get:e})},r.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,i){if(1&i&&(t=r(t)),8&i)return t;if(4&i&&"object"===typeof t&&t&&t.__esModule)return t;var e=Object.create(null);if(r.r(e),Object.defineProperty(e,"default",{enumerable:!0,value:t}),2&i&&"string"!=typeof t)for(var n in t)r.d(e,n,function(i){return t[i]}.bind(null,n));return e},r.n=function(t){var i=t&&t.__esModule?function(){return t["default"]}:function(){return t};return r.d(i,"a",i),i},r.o=function(t,i){return Object.prototype.hasOwnProperty.call(t,i)},r.p="/";var s=window["webpackJsonp"]=window["webpackJsonp"]||[],l=s.push.bind(s);s.push=i,s=s.slice();for(var c=0;c<s.length;c++)i(s[c]);var d=l;a.push([0,"chunk-vendors"]),e()})({0:function(t,i,e){t.exports=e("56d7")},"56d7":function(t,i,e){"use strict";e.r(i);e("e260"),e("e6cf"),e("cca6"),e("a79d");var n=e("2b0e"),o=e("5c96"),a=e.n(o),r=(e("0fae"),function(){var t=this,i=t.$createElement,e=t._self._c||i;return e("div",{attrs:{id:"app"}},[e("Layout")],1)}),s=[],l=function(){var t=this,i=t.$createElement,e=t._self._c||i;return e("el-card",{staticClass:"box-card"},[e("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[e("Header")],1),e("MainBody")],1)},c=[],d=function(){var t=this,i=t.$createElement,e=t._self._c||i;return e("div",[e("el-row",[e("el-col",{attrs:{xs:24,sm:24,md:24,lg:5,xl:5}},[e("span",{staticStyle:{"font-size":"30px"}},[t._v("Kindle网文助手")])]),e("el-col",{attrs:{xs:24,sm:24,md:24,lg:14,xl:14}},[e("div",{staticStyle:{"margin-top":"10px"}},[e("div",{staticClass:"hidden-md-and-down",staticStyle:{"text-align":"center"}},[e("el-input",{staticStyle:{width:"600px"},attrs:{placeholder:"请输入待检索小说名称"},model:{value:t.fictionSearchForm.fictionName,callback:function(i){t.$set(t.fictionSearchForm,"fictionName",i)},expression:"fictionSearchForm.fictionName"}},[e("el-button",{attrs:{slot:"append",icon:"el-icon-search",loading:t.searchLoading},on:{click:t.fictionSearch},slot:"append"})],1)],1),e("div",{staticClass:"hidden-lg-and-up"},[e("el-input",{staticStyle:{width:"300px"},attrs:{placeholder:"请输入待检索小说名称"},model:{value:t.fictionSearchForm.fictionName,callback:function(i){t.$set(t.fictionSearchForm,"fictionName",i)},expression:"fictionSearchForm.fictionName"}},[e("el-button",{attrs:{slot:"append",icon:"el-icon-search",loading:t.searchLoading},on:{click:t.fictionSearch},slot:"append"})],1)],1)])]),e("el-col",{staticStyle:{"margin-top":"10px"},attrs:{xs:24,sm:24,md:24,lg:5,xl:5}},[e("el-button",{attrs:{type:"primary"},on:{click:function(i){t.dialogEmailConfigViewVisible=!0}}},[t._v("配置邮箱")]),e("el-button",{attrs:{type:"primary"},on:{click:function(i){t.dialogSpiderConfigViewVisible=!0}}},[t._v("配置爬虫")])],1)],1),e("el-dialog",{attrs:{title:"搜索结果",visible:t.dialogSearchResultVisible,"with-header":!1},on:{"update:visible":function(i){t.dialogSearchResultVisible=i}}},[e("SearchedFictionsView",{attrs:{"searched-fictions":t.searchedFictions}})],1),e("el-dialog",{attrs:{title:"爬虫配置",visible:t.dialogSpiderConfigViewVisible,"with-header":!1,width:"80%"},on:{"update:visible":function(i){t.dialogSpiderConfigViewVisible=i}}},[e("SpiderConfigEditView")],1),e("el-dialog",{attrs:{title:"邮箱配置",visible:t.dialogEmailConfigViewVisible,"with-header":!1,width:"80%"},on:{"update:visible":function(i){t.dialogEmailConfigViewVisible=i}}},[e("EmailConfigEditView")],1)],1)},f=[],u=function(){var t=this,i=t.$createElement,e=t._self._c||i;return e("el-container",{directives:[{name:"loading",rawName:"v-loading",value:t.searchViewLoading,expression:"searchViewLoading"}]},[t.searchedFictions.length>0?e("div",t._l(t.searchedFictions,(function(i,n){return e("div",{key:n},[e("el-row",[e("el-col",{attrs:{xs:24,sm:24,md:6,lg:6,xl:6}},[e("div",[e("el-link",{attrs:{underline:!1,href:i.origin_url,target:"_blank"}},[e("h3",[t._v(" "+t._s(i.fiction_name))])])],1),e("el-image",{staticStyle:{width:"111px",height:"148px"},attrs:{src:i.image_url,fit:"fill"}})],1),e("el-col",{attrs:{xs:24,sm:24,md:16,lg:16,xl:16}},[e("br"),e("p",[t._v(t._s(i.introduction))]),e("el-row",[e("el-col",{attrs:{xs:24,xl:20}},[e("ul",[e("li",[t._v("作者："+t._s(i.author))]),e("li",[t._v("更新日期："+t._s(i.update_date))]),e("li",[t._v("最新章节："+t._s(i.latest_chapter))]),e("li",[t._v("来源站点："+t._s(i.site))])])]),e("el-col",{attrs:{xs:24,xl:4}},[e("br"),e("el-button",{attrs:{type:"primary"},on:{click:function(e){return t.addFiction(i)}}},[t._v("导入书籍 ")])],1)],1)],1),e("el-col",{attrs:{xs:24,sm:24,md:2,lg:2,xl:2}})],1),e("el-divider")],1)})),0):e("div",[e("h2",[t._v("无搜索结果！")])])])},p=[],m={name:"SearchedFictionsView",props:["searchedFictions"],data:function(){return{fictionId:0,addButtonLoading:!1,searchViewLoading:!1}},methods:{addFiction:function(t){var i=this,e={fiction_name:t.fiction_name,fiction_author:t.author,fiction_url:t.origin_url,site:t.site,origin_id:t.origin_id,image_url:t.image_url},n=this.base_url+"/api/v1/fictions/add/";this.searchViewLoading=!0,this.$axios.post(n,e).then((function(t){i.fictionId=t.data.fiction_id,i.updateFiction(i.fictionId),i.searchViewLoading=!1})).catch((function(t){console.error(t),i.searchViewLoading=!1}))},updateFiction:function(t){var i=this;this.$notify.info("正在发起更新请求，请稍等...");var e={fiction_id:t},n=this.base_url+"/api/v1/fictions/update/";this.$axios.post(n,e).then((function(t){console.log(t),i.$notify.success("请求成功！待更新章节数："+t.data.uncached_chapters),window.location.href="/"})).catch((function(t){console.error(t)}))}}},h=m,g=e("2877"),_=Object(g["a"])(h,u,p,!1,null,"63867b08",null),v=_.exports,b=function(){var t=this,i=t.$createElement,e=t._self._c||i;return e("div",[t.showTable?e("el-table",{attrs:{data:t.spider_configs}},[e("el-table-column",{attrs:{property:"site",label:"网站"}}),e("el-table-column",{attrs:{property:"domain",label:"域名"}}),e("el-table-column",{attrs:{property:"cls_name",label:"爬虫类名"}}),e("el-table-column",{attrs:{label:"爬虫状态"},scopedSlots:t._u([{key:"default",fn:function(i){return[1===i.row.spider_status?e("span",[t._v("开启")]):e("span",[t._v("关闭")])]}}],null,!1,1811787827)}),e("el-table-column",{attrs:{label:"操作"},scopedSlots:t._u([{key:"default",fn:function(i){return[e("el-button",{attrs:{type:"primary"},on:{click:function(e){return t.openSpiderConfigEditForm(i.row)}}},[t._v("编辑")])]}}],null,!1,250489674)})],1):e("el-form",{attrs:{model:t.formSpiderConfig,"label-width":"80px"}},[e("el-form-item",{attrs:{label:"网站"}},[e("el-input",{attrs:{disabled:""},model:{value:t.formSpiderConfig.site,callback:function(i){t.$set(t.formSpiderConfig,"site",i)},expression:"formSpiderConfig.site"}})],1),e("el-form-item",{attrs:{label:"域名"}},[e("el-input",{model:{value:t.formSpiderConfig.domain,callback:function(i){t.$set(t.formSpiderConfig,"domain",i)},expression:"formSpiderConfig.domain"}})],1),e("el-form-item",{attrs:{label:"爬虫类名"}},[e("el-input",{attrs:{disabled:""},model:{value:t.formSpiderConfig.cls_name,callback:function(i){t.$set(t.formSpiderConfig,"cls_name",i)},expression:"formSpiderConfig.cls_name"}})],1),e("el-form-item",{attrs:{label:"状态"}},[e("el-switch",{attrs:{"active-text":"开启","inactive-text":"关闭"},model:{value:t.formSpiderConfig.open_status,callback:function(i){t.$set(t.formSpiderConfig,"open_status",i)},expression:"formSpiderConfig.open_status"}})],1),e("div",{staticStyle:{"text-align":"center"}},[e("el-button",{attrs:{type:"primary"},on:{click:t.submitEdit}},[t._v("提交")]),e("el-button",{attrs:{type:"info"},on:{click:t.cancelEdit}},[t._v("取消")])],1)],1)],1)},w=[],x={name:"SpiderConfigEditView",data:function(){return{spider_configs:[],showTable:!0,formSpiderConfig:{site:"",domain:"",cls_name:"",open_status:!0,scid:0}}},methods:{getAllSpiderConfigs:function(){var t=this,i=this.base_url+"/api/v1/spider_configs/all/";this.$axios.get(i).then((function(i){t.spider_configs=i.data.spider_configs})).catch((function(i){console.error(i),t.$notify.error("啊哦，出错了！")}))},openSpiderConfigEditForm:function(t){this.formSpiderConfig={site:t.site,domain:t.domain,cls_name:t.cls_name,open_status:1===t.spider_status,scid:t.scid},this.showTable=!1},cancelEdit:function(){this.getAllSpiderConfigs(),this.showTable=!0},submitEdit:function(){var t=this,i={scid:this.formSpiderConfig.scid,domain:this.formSpiderConfig.domain,open_status:this.formSpiderConfig.open_status},e=this.base_url+"/api/v1/spider_configs/update/";this.$axios.post(e,i).then((function(i){t.$notify.success(i.data.msg)})).catch((function(i){console.error(i),t.$notify.error("啊哦，出错了！")})),this.getAllSpiderConfigs(),this.showTable=!0}},created:function(){this.getAllSpiderConfigs()}},y=x,C=Object(g["a"])(y,b,w,!1,null,"01f4a92c",null),S=C.exports,$=function(){var t=this,i=t.$createElement,e=t._self._c||i;return e("div",[e("el-form",{attrs:{model:t.formEmailConfig,"label-width":"120px"}},[e("el-form-item",{attrs:{label:"发件人邮箱"}},[e("el-input",{attrs:{placeholder:"你在亚马逊官网添加的'已认可的发件人电子邮箱',如'xxx@163.com'"},model:{value:t.formEmailConfig.sender,callback:function(i){t.$set(t.formEmailConfig,"sender",i)},expression:"formEmailConfig.sender"}})],1),e("el-form-item",{attrs:{label:"密码/授权码"}},[e("el-input",{attrs:{type:"password",placeholder:"发件邮箱对应的密码或授权码"},model:{value:t.formEmailConfig.password,callback:function(i){t.$set(t.formEmailConfig,"password",i)},expression:"formEmailConfig.password"}})],1),e("el-form-item",{attrs:{label:"SMTP主机地址"}},[e("el-input",{attrs:{placeholder:"发件邮箱的SMTP主机地址，如'smtp.163.com'"},model:{value:t.formEmailConfig.smtp_host,callback:function(i){t.$set(t.formEmailConfig,"smtp_host",i)},expression:"formEmailConfig.smtp_host"}})],1),e("el-form-item",{attrs:{label:"SMTP端口"}},[e("el-input",{attrs:{placeholder:"发件邮箱的SMTP端口，如465"},model:{value:t.formEmailConfig.smtp_port,callback:function(i){t.$set(t.formEmailConfig,"smtp_port",i)},expression:"formEmailConfig.smtp_port"}})],1),e("el-form-item",{attrs:{label:"收件人邮箱"}},[e("el-input",{attrs:{placeholder:"你在亚马逊官网配置的〖发送至Kindle〗电子邮箱,如'xxx@kindle.cn'"},model:{value:t.formEmailConfig.recipient,callback:function(i){t.$set(t.formEmailConfig,"recipient",i)},expression:"formEmailConfig.recipient"}})],1),e("div",{staticStyle:{"text-align":"center"}},[e("el-button",{attrs:{type:"primary"},on:{click:t.submitEdit}},[t._v("提交")]),e("el-button",{attrs:{type:"danger"},on:{click:t.clearEdit}},[t._v("清空")])],1)],1)],1)},V=[],E={name:"EmailConfigEditView",data:function(){return{formEmailConfig:{ecid:0,sender:"",password:"",smtp_host:"smtp.163.com",smtp_port:465,recipient:""}}},methods:{getEmailConfig:function(){var t=this,i=this.base_url+"/api/v1/email_config/";this.$axios.get(i).then((function(i){t.formEmailConfig=i.data.email_config})).catch((function(i){console.error(i),t.$notify.error("啊哦，出错了！")}))},clearEdit:function(){this.formEmailConfig={ecid:0,sender:"",password:"",smtp_host:"",smtp_port:"",recipient:""}},submitEdit:function(){var t=this,i=this.base_url+"/api/v1/email_config/update/";this.$axios.post(i,this.formEmailConfig).then((function(i){t.$notify.success(i.data.msg)})).catch((function(i){console.log(i),t.$notify.error("啊哦，出错了！")}))}},created:function(){this.getEmailConfig()}},F=E,k=Object(g["a"])(F,$,V,!1,null,"8442f7dc",null),L=k.exports,T=(e("e05f"),{name:"Header",components:{SearchedFictionsView:v,SpiderConfigEditView:S,EmailConfigEditView:L},data:function(){return{fictionSearchForm:{fictionName:""},searchedFictions:[],dialogSearchResultVisible:!1,searchLoading:!1,dialogSpiderConfigViewVisible:!1,dialogEmailConfigViewVisible:!1}},methods:{fictionSearch:function(){var t=this,i={fiction_name:this.fictionSearchForm.fictionName};this.searchLoading=!0,this.$notify.info({title:"",message:"正在搜索中，请稍后...",showClose:!0,duration:4500});var e=this.base_url+"/api/v1/search/name/";this.$axios.post(e,i).then((function(i){t.searchedFictions=i.data.fictions,t.searchLoading=!1,t.$notify.success({title:"",message:"搜索完成！",showClose:!0,duration:3e3}),t.dialogSearchResultVisible=!0})).catch((function(i){t.$notify.error("啊哦，出错了！"),console.error(i)}))}}}),O=T,j=Object(g["a"])(O,d,f,!1,null,"d57505c2",null),B=j.exports,A=function(){var t=this,i=t.$createElement,e=t._self._c||i;return e("DownloadedFictionView")},M=[],P=function(){var t=this,i=t.$createElement,e=t._self._c||i;return e("div",{directives:[{name:"loading",rawName:"v-loading",value:t.downloadedViewLoading,expression:"downloadedViewLoading"}]},[t.total>0?e("div",[e("el-row",t._l(t.fictions,(function(i){return e("el-col",{key:i.fid,attrs:{xs:24,sm:24,md:12,lg:8,xl:4}},[e("el-row",[e("el-col",{attrs:{span:2}}),e("el-col",{attrs:{span:20}},[e("el-card",{staticClass:"box-card",attrs:{shadow:"hover"}},[e("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[e("span",{staticStyle:{"text-align":"center",display:"block"}},[t._v(t._s(i.fiction_name))])]),e("el-row",[e("el-col",{attrs:{span:10}},[e("el-image",{staticStyle:{width:"120px",height:"180px"},attrs:{src:i.image_url,fit:"fill"}})],1),e("el-col",{attrs:{offset:4,span:10}},[e("div",{staticClass:"button-margin"},[e("el-button",{attrs:{type:"primary"},on:{click:function(e){return t.updateFiction(i.fid)}}},[t._v(" 更新 ")])],1),e("div",{staticClass:"button-margin"},[e("el-button",{attrs:{type:"primary"},on:{click:function(e){return t.downloadFictionConfirm(i)}}},[t._v(" 导出 ")])],1),e("div",{staticClass:"button-margin"},[e("el-button",{attrs:{type:"success"},on:{click:function(e){return t.sendFictionConfirm(i.fid)}}},[t._v(" 推送 ")])],1),e("div",{staticClass:"button-margin"},[e("el-button",{attrs:{type:"danger"},on:{click:function(e){return t.deleteFiction(i.fid)}}},[t._v(" 删除 ")])],1)])],1),e("el-row",[e("el-col",{attrs:{span:20}},[e("div",[e("el-progress",{attrs:{"text-inside":!0,"show-text":!0,"stroke-width":24,percentage:i.cached_percentage,status:"primary"}})],1),e("div",{staticStyle:{"text-align":"center"}},[e("span",[t._v(t._s(i.cached_chapters_number)+"/"+t._s(i.fiction_chapters_total))])])])],1)],1)],1),e("el-col",{attrs:{span:2}})],1)],1)})),1),e("div",{staticStyle:{"text-align":"center"}},[e("el-pagination",{attrs:{background:"",layout:"prev, pager, next","current-page":t.cur_page,"page-size":t.page_size,total:t.total}})],1)],1):e("div",[e("h1",{staticStyle:{"text-align":"center"}},[t._v("暂无缓存书籍，快去添加吧！")])])])},N=[],z={name:"DownloadedFictionView",data:function(){return{fictionCols:6,fictions:[],cur_page:1,page_size:18,downloadedViewLoading:!1,total:0}},mounted:function(){this.$nextTick((function(){this.autoRefresh()}))},methods:{getAllFictions:function(){var t=this;this.downloadedViewLoading=!0;var i={cur_page:this.cur_page,page_size:this.page_size},e=this.base_url+"/api/v1/fictions/all/";this.$axios.post(e,i).then((function(i){t.fictions=i.data.fictions,t.total=i.data.total,t.downloadedViewLoading=!1})).catch((function(i){console.error(i),t.$notify.error("啊哦，出错了！"),t.downloadedViewLoading=!1}))},_getAllFictions:function(){var t=this,i={cur_page:this.cur_page,page_size:this.page_size},e=this.base_url+"/api/v1/fictions/all/";this.$axios.post(e,i).then((function(i){t.fictions=i.data.fictions,t.total=i.data.total})).catch((function(i){console.error(i),t.$notify.error("加载缓存进度出错！")}))},updateFiction:function(t){var i=this;this.$notify.info("正在发起更新请求，请稍等...");var e={fiction_id:t},n=this.base_url+"/api/v1/fictions/update/";this.downloadedViewLoading=!0,this.$axios.post(n,e).then((function(t){console.log(t),i.$notify.success("请求成功！待更新章节数："+t.data.uncached_chapters),i.getAllFictions(),i.downloadedViewLoading=!1})).catch((function(t){console.error(t),i.$notify.error("啊哦，出错了！"),i.downloadedViewLoading=!1}))},deleteFiction:function(t){var i=this;this.$confirm("删除小说会同时删除此小说的所有章节，确认删除吗？","提示",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then((function(){i.downloadedViewLoading=!0;var e=i.base_url+"/api/v1/fictions/delete/"+t;i.$axios.get(e).then((function(t){i.$notify.success(t.data.msg),i.getAllFictions(),i.downloadedViewLoading=!1})).catch((function(t){console.error(t),i.$notify.error("啊哦，出错了！"),i.downloadedViewLoading=!1}))}))},downloadFiction:function(t){this.downloadedViewLoading=!0,this.$notify.info("正在生成小说文件，请稍等……");var i=this.base_url+"/api/v1/fictions/download/"+t;window.open(i,"_blank"),this.downloadedViewLoading=!1},downloadFictionConfirm:function(t){var i=this;t.cached_chapters_number<t.fiction_chapters_total?this.$confirm("小说的全部章节可能没有缓存完成，确认导出小说文件到本地吗？","提示",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then((function(){i.downloadFiction(t.fid)})):this.$confirm("即将导出小说文件到本地，确认执行吗？","提示",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then((function(){i.downloadFiction(t.fid)}))},sendFictionConfirm:function(t){var i=this;this.$confirm("即将通过邮箱推送小说到kindle，确认推送吗？(请确保已正确配置邮箱信息，否则无法成功推送)","提示",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then((function(){i.downloadedViewLoading=!0,i.$notify.info("正在发起推送请求，请稍等……");var e=i.base_url+"/api/v1/fictions/send/"+t;i.$axios.get(e).then((function(t){0===t.data.code?i.$notify.success(t.data.msg):i.$notify.error(t.data.msg),i.downloadedViewLoading=!1})).catch((function(t){console.error(t),i.$notify.error("啊哦，出错了！"),i.downloadedViewLoading=!1}))}))},autoRefresh:function(){setInterval(this._getAllFictions,5e3)}},created:function(){this.getAllFictions()}},R=z,I=(e("aeda"),Object(g["a"])(R,P,N,!1,null,"0d42e754",null)),D=I.exports,H={name:"MainBody",components:{DownloadedFictionView:D}},J=H,K=Object(g["a"])(J,A,M,!1,null,"7051ac7c",null),q=K.exports,G={name:"Layout",components:{Header:B,MainBody:q}},Q=G,U=Object(g["a"])(Q,l,c,!1,null,"096471b6",null),W=U.exports,X={name:"App",components:{Layout:W}},Y=X,Z=Object(g["a"])(Y,r,s,!1,null,null,null),tt=Z.exports,it=e("bc3a"),et=e.n(it);n["default"].prototype.$axios=et.a,n["default"].prototype.base_url="",n["default"].use(a.a),n["default"].config.productionTip=!1,new n["default"]({render:function(t){return t(tt)}}).$mount("#app")},aeda:function(t,i,e){"use strict";var n=e("af5b"),o=e.n(n);o.a},af5b:function(t,i,e){}});
//# sourceMappingURL=app.b1e8cc06.js.map